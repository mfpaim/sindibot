<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Planejador Estratégico • Sindi Coruja</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  :root { --laranja:#FF6B35; --cinza:#f8fafc; --texto:#1e293b; --borda:#e2e8f0; }
  body {margin:0; font-family:system-ui,-apple-system,sans-serif; background:var(--cinza); color:var(--texto); line-height:1.5}
  .container {max-width:900px; margin:20px auto; padding:0 16px}

  header {text-align:center; padding:40px 20px; background:white; border-radius:24px; box-shadow:0 10px 40px rgba(0,0,0,0.08); margin-bottom:30px}
  .coruja {width:110px;height:110px;border:6px solid var(--laranja);border-radius:50%;box-shadow:0 10px 30px rgba(255,107,53,0.3)}
  h1 {margin:20px 0 8px;font-size:30px;color:#111}
  .subtitle {color:#64748b;font-size:17px}
  .condominio-info {margin-top:20px;font-size:18px;color:#444}
  .data {color:var(--laranja);font-weight:600}

  .botoes {text-align:center;margin:30px 0}
 0}
  .btn {padding:14px 32px;border:none;border-radius:50px;font-size:17px;font-weight:600;cursor:pointer;margin:0 10px;color:white;box-shadow:0 6px 20px rgba(0,0,0,0.15)}
  .add-btn {background:var(--laranja)}
  .pdf-btn {background:#10b981}
  .add-btn:hover {background:#e55a2b}
  .pdf-btn:hover {background:#059669}

  .form-card {background:white;border-radius:20px;padding:32px;box-shadow:0 10px 40px rgba(0,0,0,0.08);margin-bottom:40px;display:none}
  .form-card h2 {margin:0 0 28px;font-size:24px;color:#111}
  .form-grid {display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:24px}
  @media(max-width:640px){.form-grid{grid-template-columns:1fr}}
  .full {grid-column:1/-1}
  label {display:block;margin-bottom:8px;font-weight:600;color:#334155;font-size:15px}
  input[type=text],input[type=number],select {width:100%;padding:16px;border:2px solid var(--borda);border-radius:12px;font-size:16px;box-sizing:border-box}
  input:focus,select:focus {outline:none;border-color:var(--laranja);box-shadow:0 0 0 4px rgba(255,107,53,0.15)}
  .checkbox-line {grid-column:1/-1;display:flex;align-items:center;gap:12px;margin:24px 0 32px;font-size:15px}
  .checkbox-line input[type=checkbox]{width:22px;height:22px;accent-color:var(--laranja)}
  .form-actions {display:flex;gap:16px;flex-wrap:wrap}
  .btn-cancel {background:#e2e8f0;color:#475569}

  .fila h2 {margin:50px 0 20px;font-size:26px;color:#111}
  .item {
    background:white;border-radius:16px;padding:20px 24px;margin-bottom:16px;
    box-shadow:0 6px 25px rgba(0,0,0,0.09);border-left:6px solid var(--laranja);
    display:flex;align-items:center;gap:20px;position:relative
  }
  .rank {font-size:46px;font-weight:800;color:var(--laranja);line-height:1;flex-shrink:0}
  .content {flex:1;min-width:0}
  .header-card {display:flex;justify-content:space-between;align-items:flex-start;flex:1}
  .titulo {font-size:20px;font-weight:600;margin:0;flex:1}
  .edit-btn {background:#f59e0b;color:white;border:none;padding:8px 16px;border-radius:50px;cursor:pointer;font-size:13px;font-weight:600;flex-shrink:0}
  .edit-btn:hover {background:#e67e22}
  .tags {display:flex;flex-wrap:wrap;gap:8px;margin:12px 0}
  .tag {padding:5px 12px;border-radius:20px;font-size:12.5px;font-weight:600}
  .baixa {background:#dbeafe;color:#4338ca}
  .media {background:#fef3c7;color:#92400e}
  .alta {background:#fee2e2;color:#991b1b}
  .critica {background:#fecaca;color:#7f1d1d;animation:pulse 2s infinite}
  .seguranca {background:#fecaca;color:#991b1b}
  .lazer {background:#d1fae5;color:#065f46}
  .manutencao {background:#dbeafe;color:#1e40af}
  .legal {background:#ffedd5;color:#9a3412}
  .estetica {background:#f3e8ff;color:#7c3aed}
  .score {font-size:17px;font-weight:700;color:#374151}
  .critico {color:#dc2626}

  .insights {background:linear-gradient(135deg,#6366f1,#4f46e6);color:white;padding:32px;border-radius:20px;margin:60px 0}
  .insights h3 {margin:0 0 16px;font-size:22px}

  @keyframes pulse {0%{box-shadow:0 0 0 0 rgba(255,107,53,0.5)}70%{box-shadow:0 0 0 12px rgba(255,107,53,0)}100%{box-shadow:0 0 0 0 rgba(255,107,53,0)}}

  @media print {
    body {background:white;padding:30px}
    .botoes,.form-card,.edit-btn,.checkbox-line input {display:none !important}
    }
    .item {box-shadow:none;border:1px solid #ddd;page-break-inside:avoid;margin:20px 0;padding:20px}
    header {box-shadow:none;margin-bottom:40px}
    .condominio-info {font-size:20px !important}
  }
</style>
</head>
<body>

<div class="container">
  <header>
    <img src="https://salvatore.s3.us-east-2.amazonaws.com/sindi/SindiCIrcle.png" class="coruja" alt="Sindi">
    <h1>Planejador Estratégico para Síndicos</h1>
    <p class="subtitle">Seu segundo cérebro — decisões inteligentes para o condomínio</p>
    <div class="condominio-info">
      Condomínio: <strong id="nomeCondominio">Residencial Jardim das Flores</strong><br>
      <span class="data" id="dataAtual"></span>
    </div>
  </header>

  <div class="botoes">
    <button class="btn add-btn" onclick="mostrarForm()">+ Nova Demanda</button>
    <button class="btn pdf-btn" onclick="window.print()">Exportar em PDF</button>
  </div>

  <div class="form-card" id="formCard">
    <h2>Nova Demanda</h2>
    <label>Título da demanda</label>
    <input type="text" id="titulo" placeholder="Ex: Reparo no elevador principal">

    <div class="form-grid">
      <div><label>Moradores afetados</label><input type="number" id="moradores" value="50"></div>
      <div></div>
    </div>

    <div class="form-grid">
      <div><label>Urgência</label><select id="urgencia"><option>Baixa</option><option selected>Média</option><option>Alta</option><option>Crítica</option></select></div>
      <div><label>Impacto</label><select id="impactoNivel"><option>Baixo</option><option selected>Médio</option><option>Alto</option></select></div>
    </div>

    <div class="form-grid full">
      <label>Categoria principal</label>
      <select id="impacto">
        <option>Estética</option><option>Segurança</option><option selected>Manutenção</option><option>Lazer</option><option>Obrigação Legal</option>
      </select>
    </div>

    <div class="checkbox-line">
      <input type="checkbox" id="legal">
      <label for="legal">Obrigação legal</label>
    </div>

    <div class="form-actions">
      <button class="btn add-btn" onclick="salvarDemanda()">Adicionar</button>
      <button class="btn btn-cancel" onclick="esconderForm()">Cancelar</button>
    </div>
  </div>

  <div class="fila">
    <h2>Fila de Priorização Inteligente</h2>
    <div id="fila"></div>
  </div>

  <div class="insights" id="insights" style="display:none">
    <h3>Insights Estratégicos da Coruja</h3>
    <ul id="listaInsights"></ul>
  </div>
</div>

<script>
const demandas = [];

// Nome do condomínio salvo uma única vez
if (!localStorage.getItem("nomeCondominio")) {
  const nome = prompt("Qual o nome do condomínio?", "Residencial Jardim das Flores") || "Condomínio";
  localStorage.setItem("nomeCondominio", nome);
}
document.getElementById("nomeCondominio").textContent = localStorage.getItem("nomeCondominio");

const hoje = new Date().toLocaleDateString('pt-BR', {weekday:'long', year:'numeric', month:'long', day:'numeric'});
document.getElementById("dataAtual").textContent = "Planejamento gerado em " + hoje;

function mostrarForm(editId = null) {
  document.getElementById("formCard").style.display = "block";
  // preenche ou limpa campos
  const d = editId ? demandas.find(x=>x.id===editId) : null;
  document.getElementById("titulo").value = d?.titulo || "";
  document.getElementById("moradores").value = d?.moradores || "50";
  document.getElementById("urgencia").value = d?.urgencia || "Média";
  document.getElementById("impacto").value = d?.impacto || "Manutenção";
  document.getElementById("impactoNivel").value = d?.impactoNivel || "Médio";
  document.getElementById("legal").checked = d?.legal || false;
  window.editando = editId;
}

function esconderForm() { document.getElementById("formCard").style.display = "none"; }

function salvarDemanda() {
  const titulo = document.getElementById("titulo").value.trim();
  if (!titulo) return alert("Digite o título da demanda");

  const demanda = {
    id: window.editando || Date.now(),
    titulo,
    moradores: +document.getElementById("moradores").value || 0,
    urgencia: document.getElementById("urgencia").value,
    impacto: document.getElementById("impacto").value,
    impactoNivel: document.getElementById("impactoNivel").value,
    legal: document.getElementById("legal").checked
  };

  if (window.editando) {
    const i = demandas.findIndex(x=>x.id===window.editando);
    demandas[i] = demanda;
  } else demandas.push(demanda);

  esconderForm();
  atualizarTudo();
}

function editar(id) { mostrarForm(id); }
function excluir(id) {
  if (confirm("Excluir demanda?")) {
    demandas.splice(demandas.findIndex(x=>x.id===id),1);
    atualizarTudo();
  }
}

function calcularScore(d) {
  let s = 0;
  s += {Baixa:10, Média:30, Alta:60, Crítica:90}[d.urgencia] || 0;
  if (d.legal) s += 50;
  if (d.impacto==="Segurança") s += 40;
  s += {Baixo:5, Médio:15, Alto:30}[d.impactoNivel] || 0;
  s += Math.min(d.moradores/3, 25);
  return Math.round(s);
}

function atualizarTudo() {
  const ordenadas = [...demandas].sort((a,b)=>calcularScore(b)-calcularScore(a));
  let html = "";
  ordenadas.forEach((d,i) => {
    const score = calcularScore(d);
    const urgClass = d.urgencia==="Crítica"?"critica":d.urgencia.toLowerCase();
    const impClass = d.impacto==="Estética"?"estetica":d.impacto.toLowerCase().replace(/ /g,"-");
    html += `
      <div class="item">
        <div class="rank">#${ordenadas.indexOf(d)+1}</div>
        <div class="header-card">
          <div class="titulo">${d.titulo}</div>
          <button class="edit-btn" onclick="editar(${d.id})">Editar</button>
        </div>
        <div class="tags">
          <span class="tag ${urgClass}">${d.urgencia}</span>
          <span class="tag ${impClass}">${d.impacto}</span>
          <span class="tag">${d.moradores} moradores</span>
          ${d.legal ? '<span class="tag legal">OBRIGAÇÃO LEGAL</span>' : ''}
        </div>
        <div class="score ${score>=80?'critico':''}">Score: ${score}</div>
      </div>`;
  });
  document.getElementById("fila").innerHTML = html || "<p style='text-align:center;color:#999;padding:60px'>Nenhuma demanda cadastrada</p>";

  // insights (mesmo código de antes)
  const criticas = demandas.filter(d=>d.urgencia==="Crítica").length;
  const legais = demandas.filter(d=>d.legal).length;
  const seguranca = demandas.filter(d=>d.impacto==="Segurança").length;
  let insights = [];
  if (legais>0) insights.push(`Priorize as ${legais} obrigação(ões) legais`);
  if (criticas>0) insights.push(`${criticas} item(s) CRÍTICO(S)`);
  if (seguranca>0) insights.push("Segurança em primeiro lugar");
  if (demandas.length>5) insights.push("Foque nas 3 primeiras da fila");
  if (insights.length===0) insights.push("Tudo sob controle!");

  document.getElementById("listaInsights").innerHTML = insights.map(t=>`<li>${t}</li>`).join("");
  document.getElementById("insights").style.display = demandas.length > 0 ? "block" : "none";
}

atualizarTudo();
</script>
</body>
</html>
