<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sindi - Analista de Contratos</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, sans-serif; background: #f8f9fa; min-height: 100vh; padding: 20px; }
    .container { max-width: 1000px; margin: 0 auto; }
    .header { background: white; border-radius: 28px; padding: 32px 28px; margin-bottom: 24px; box-shadow: 0 15px 45px rgba(0,0,0,0.08); text-align: center; border: 1px solid #eee; }
    .logo { width: 80px; height: 80px; border-radius: 50%; border: 4px solid #FF6B35; margin: 0 auto 16px; box-shadow: 0 4px 12px rgba(255,107,53,0.25); }
    h1 { font-size: 28px; color: #222; margin-bottom: 8px; font-weight: 700; }
    .subtitle { color: #666; font-size: 16px; }
    .form-card { background: white; border-radius: 24px; padding: 32px 28px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); border: 1px solid #eee; margin-bottom: 24px; }
    .info-banner { background: #e3f2fd; border-left: 4px solid #2196f3; padding: 16px; border-radius: 8px; margin-bottom: 24px; font-size: 14px; color: #1565c0; }
    .info-banner strong { display: block; margin-bottom: 4px; }
    .info-banner ul { margin-left: 20px; margin-top: 8px; }
    .info-banner li { margin-bottom: 4px; }
    .section-title { font-size: 18px; font-weight: 600; color: #333; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 2px solid #f0f0f0; }
    .form-group { margin-bottom: 20px; }
    .form-label { display: block; font-size: 14px; font-weight: 600; color: #333; margin-bottom: 8px; }
    .required { color: #FF6B35; }
    input[type="text"], select, textarea { width: 100%; padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 12px; font-size: 15px; background: white; color: #333; transition: all 0.3s; font-family: inherit; }
    textarea { resize: vertical; min-height: 120px; }
    input:focus, select:focus, textarea:focus { outline: none; border-color: #FF6B35; box-shadow: 0 0 0 3px rgba(255,107,53,0.15); }
    .form-hint { font-size: 13px; color: #999; margin-top: 6px; }
    .file-upload-area { border: 3px dashed #e0e0e0; border-radius: 16px; padding: 32px; text-align: center; transition: all 0.3s; cursor: pointer; background: #fafafa; }
    .file-upload-area:hover { border-color: #FF6B35; background: #fff8f5; }
    .file-upload-area.dragover { border-color: #FF6B35; background: #fff8f5; transform: scale(1.02); }
    .file-upload-icon { font-size: 48px; margin-bottom: 16px; }
    .file-upload-text { font-size: 16px; color: #333; font-weight: 600; margin-bottom: 8px; }
    .file-upload-hint { font-size: 14px; color: #999; }
    input[type="file"] { display: none; }
    .file-list { margin-top: 16px; }
    .file-item { background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 12px; padding: 12px 16px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
    .file-info { display: flex; align-items: center; gap: 12px; flex: 1; }
    .file-icon { font-size: 24px; }
    .file-details { flex: 1; }
    .file-name { font-size: 14px; font-weight: 600; color: #333; }
    .file-size { font-size: 12px; color: #999; }
    .btn-remove-file { background: #ffebee; color: #c62828; border: 2px solid #ef5350; padding: 6px 12px; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
    .btn-remove-file:hover { background: #ef5350; color: white; }
    .btn-group { display: flex; gap: 12px; margin-top: 32px; flex-wrap: wrap; }
    .btn { flex: 1; min-width: 200px; padding: 16px; border-radius: 16px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; border: none; }
    .btn-analyze { background: linear-gradient(135deg, #FF6B35 0%, #ff8555 100%); color: white; box-shadow: 0 4px 12px rgba(255,107,53,0.3); }
    .btn-analyze:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(255,107,53,0.4); }
    .btn-clear { background: #f5f5f5; color: #666; border: 2px solid #e0e0e0; }
    .btn-clear:hover:not(:disabled) { background: #e8e8e8; border-color: #FF6B35; color: #FF6B35; }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
    .error-message { background: #ffebee; border: 2px solid #f44336; color: #c62828; padding: 16px; border-radius: 14px; margin-bottom: 24px; text-align: center; font-weight: 600; display: none; }
    .error-message.show { display: block; animation: slideUp 0.3s ease; }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .results-card { background: white; border-radius: 24px; padding: 32px 28px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); border: 1px solid #eee; display: none; }
    .results-card.show { display: block; animation: slideUp 0.4s ease; }
    .loading { text-align: center; padding: 40px; display: none; }
    .loading.show { display: block; }
    .loading-spinner { width: 48px; height: 48px; border: 4px solid #f3f3f3; border-top: 4px solid #FF6B35; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 16px; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .loading-text { color: #666; font-size: 16px; font-weight: 600; margin-bottom: 8px; }
    .loading-subtext { color: #999; font-size: 14px; }
    .contract-header { background: #f8f9fa; border-radius: 12px; padding: 20px; margin-bottom: 24px; }
    .contract-info { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; }
    .info-item { }
    .info-label { font-size: 12px; color: #888; font-weight: 600; text-transform: uppercase; margin-bottom: 4px; }
    .info-value { font-size: 15px; color: #333; font-weight: 600; }
    .analysis-section { margin-bottom: 32px; }
    .analysis-section:last-child { margin-bottom: 0; }
    .analysis-title { font-size: 20px; font-weight: 700; color: #222; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
    .analysis-content { background: #f8f9fa; border-radius: 12px; padding: 20px; line-height: 1.8; color: #333; }
    .analysis-content h3 { font-size: 16px; color: #FF6B35; margin-top: 16px; margin-bottom: 8px; }
    .analysis-content h3:first-child { margin-top: 0; }
    .analysis-content ul { margin-left: 20px; margin-top: 8px; }
    .analysis-content li { margin-bottom: 8px; }
    .analysis-content strong { color: #222; }
    .footer { text-align: center; margin-top: 32px; padding: 20px; color: #888; font-size: 14px; }
    .footer span { color: #FF6B35; font-weight: bold; }
    .select-wrapper { position: relative; }
    select { appearance: none; background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%23FF6B35' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 16px center; padding-right: 45px; }
    .checkbox-group { display: flex; flex-wrap: wrap; gap: 16px; margin-top: 12px; }
    .checkbox-item { display: flex; align-items: center; gap: 8px; }
    .checkbox-item input[type="checkbox"] { width: 20px; height: 20px; cursor: pointer; accent-color: #FF6B35; }
    .checkbox-item label { font-size: 14px; color: #333; cursor: pointer; margin: 0; }
    .download-link { display: inline-block; margin-top: 12px; padding: 10px 16px; background: #e3f2fd; color: #1565c0; text-decoration: none; border-radius: 8px; font-size: 14px; font-weight: 600; transition: all 0.3s; }
    .download-link:hover { background: #1565c0; color: white; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img class="logo" src="https://salvatore.s3.us-east-2.amazonaws.com/sindi/SindiCIrcle.png" alt="Sindi">
      <h1>Analista de Contratos</h1>
      <p class="subtitle">An√°lise inteligente e detalhada de contratos com IA</p>
    </div>
    
    <div id="errorMessage" class="error-message"><span id="errorText">Erro ao analisar contrato. Tente novamente.</span></div>
    
    <div class="form-card">
      <div class="info-banner">
        <strong>ü§ñ Como funciona</strong>
        Fa√ßa upload do contrato e nossa IA analisar√° automaticamente:
        <ul>
          <li>üìã Resumo anal√≠tico completo</li>
          <li>‚ö†Ô∏è Pontos de aten√ß√£o e riscos</li>
          <li>üîç Cl√°usulas importantes e diverg√™ncias</li>
          <li>üí∞ Valores, multas e condi√ß√µes de rescis√£o</li>
          <li>üìÖ Prazos e vig√™ncias</li>
          <li>‚úÖ Recomenda√ß√µes e pr√≥ximos passos</li>
        </ul>
      </div>
      
      <form id="analysisForm">
        <div class="section-title">üìÑ Upload do Contrato</div>
        
        <div class="form-group">
          <label class="form-label">Arquivo do Contrato <span class="required">*</span></label>
          <div class="file-upload-area" id="fileUploadArea">
            <div class="file-upload-icon">üìÑ</div>
            <div class="file-upload-text">Clique ou arraste o arquivo aqui</div>
            <div class="file-upload-hint">PDF, DOC, DOCX at√© 10MB</div>
          </div>
          <input type="file" id="fileInput" accept=".pdf,.doc,.docx" required>
          <div id="fileList" class="file-list"></div>
        </div>
        
        <div class="section-title">üè¢ Informa√ß√µes do Contrato</div>
        
        <div class="form-group">
          <label class="form-label">Condom√≠nio <span class="required">*</span></label>
          <div class="select-wrapper">
            <select id="condominio" required>
              <option value="">Selecione o condom√≠nio</option>
              <option value="Edif√≠cio Central Park">Edif√≠cio Central Park</option>
              <option value="Residencial Jardins">Residencial Jardins</option>
              <option value="Condom√≠nio Vista Verde">Condom√≠nio Vista Verde</option>
              <option value="Torres do Sol">Torres do Sol</option>
            </select>
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Tipo de Contrato <span class="required">*</span></label>
          <div class="select-wrapper">
            <select id="tipoContrato" required>
              <option value="">Selecione o tipo</option>
              <option value="prestacao-servicos">Presta√ß√£o de Servi√ßos</option>
              <option value="fornecimento">Fornecimento</option>
              <option value="manutencao">Manuten√ß√£o</option>
              <option value="locacao">Loca√ß√£o</option>
              <option value="seguro">Seguro</option>
              <option value="obra">Obra/Constru√ß√£o</option>
              <option value="outros">Outros</option>
            </select>
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Nome/Descri√ß√£o do Contrato</label>
          <input type="text" id="nomeContrato" placeholder="Ex: Contrato de limpeza mensal, Seguro predial...">
          <div class="form-hint">Identifica√ß√£o do contrato para organiza√ß√£o</div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Aspectos Espec√≠ficos para An√°lise</label>
          <div class="checkbox-group">
            <div class="checkbox-item">
              <input type="checkbox" id="checkResumo" checked disabled>
              <label for="checkResumo">Resumo Geral</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="checkPontosAtencao" checked>
              <label for="checkPontosAtencao">Pontos de Aten√ß√£o</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="checkValores" checked>
              <label for="checkValores">Valores e Custos</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="checkRescisao" checked>
              <label for="checkRescisao">Rescis√£o e Multas</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="checkPrazos" checked>
              <label for="checkPrazos">Prazos e Vig√™ncias</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="checkObrigacoes" checked>
              <label for="checkObrigacoes">Obriga√ß√µes das Partes</label>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Observa√ß√µes Adicionais</label>
          <textarea id="observacoes" placeholder="Adicione qualquer contexto ou d√∫vida espec√≠fica sobre o contrato que gostaria que fosse analisada..."></textarea>
        </div>
        
        <div class="btn-group">
          <button type="submit" class="btn btn-analyze" id="analyzeBtn">üîç Analisar Contrato</button>
          <button type="button" class="btn btn-clear" id="clearBtn">üóëÔ∏è Limpar</button>
        </div>
      </form>
    </div>
    
    <div id="loadingState" class="loading">
      <div class="loading-spinner"></div>
      <div class="loading-text">Analisando contrato...</div>
      <div class="loading-subtext">Isso pode levar alguns instantes</div>
    </div>
    
    <div id="resultsCard" class="results-card">
      <div class="section-title">üìä Resultado da An√°lise</div>
      <div id="analysisResults"></div>
    </div>
    
    <div class="footer">Sindi - Analista de Contratos <span>Sindibot - Impactar LLC</span></div>
  </div>
  
  <script>
    var WEBHOOK_URL = 'https://n8n.polenta.chat/webhook-test/analisar-contrato';
    var selectedFile = null;
    
    var fileUploadArea = document.getElementById('fileUploadArea');
    var fileInput = document.getElementById('fileInput');
    var fileList = document.getElementById('fileList');
    var analysisForm = document.getElementById('analysisForm');
    var clearBtn = document.getElementById('clearBtn');
    var analyzeBtn = document.getElementById('analyzeBtn');
    
    // Click na √°rea de upload
    fileUploadArea.addEventListener('click', function() {
      fileInput.click();
    });
    
    // Drag and drop
    fileUploadArea.addEventListener('dragover', function(e) {
      e.preventDefault();
      fileUploadArea.classList.add('dragover');
    });
    
    fileUploadArea.addEventListener('dragleave', function(e) {
      e.preventDefault();
      fileUploadArea.classList.remove('dragover');
    });
    
    fileUploadArea.addEventListener('drop', function(e) {
      e.preventDefault();
      fileUploadArea.classList.remove('dragover');
      
      if (e.dataTransfer.files.length > 0) {
        var file = e.dataTransfer.files[0];
        handleFile(file);
      }
    });
    
    // Change no input
    fileInput.addEventListener('change', function() {
      if (fileInput.files.length > 0) {
        handleFile(fileInput.files[0]);
      }
    });
    
    function handleFile(file) {
      if (file.size > 10 * 1024 * 1024) {
        document.getElementById('errorText').textContent = '‚ùå Arquivo muito grande. M√°ximo 10MB.';
        document.getElementById('errorMessage').classList.add('show');
        return;
      }
      
      var validTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
      if (!validTypes.includes(file.type)) {
        document.getElementById('errorText').textContent = '‚ùå Tipo de arquivo inv√°lido. Use PDF, DOC ou DOCX.';
        document.getElementById('errorMessage').classList.add('show');
        return;
      }
      
      selectedFile = file;
      displayFile(file);
      document.getElementById('errorMessage').classList.remove('show');
    }
    
    function displayFile(file) {
      var size = (file.size / 1024).toFixed(2);
      var unit = 'KB';
      if (size > 1024) {
        size = (size / 1024).toFixed(2);
        unit = 'MB';
      }
      
      var icon = 'üìÑ';
      if (file.type.includes('pdf')) icon = 'üìï';
      else if (file.type.includes('word')) icon = 'üìò';
      
      fileList.innerHTML = 
        '<div class="file-item">' +
          '<div class="file-info">' +
            '<div class="file-icon">' + icon + '</div>' +
            '<div class="file-details">' +
              '<div class="file-name">' + file.name + '</div>' +
              '<div class="file-size">' + size + ' ' + unit + '</div>' +
            '</div>' +
          '</div>' +
          '<button type="button" class="btn-remove-file" onclick="removeFile()">‚úñ Remover</button>' +
        '</div>';
    }
    
    function removeFile() {
      selectedFile = null;
      fileInput.value = '';
      fileList.innerHTML = '';
    }
    
    // Bot√£o limpar
    clearBtn.addEventListener('click', function() {
      analysisForm.reset();
      removeFile();
      document.getElementById('resultsCard').classList.remove('show');
      document.getElementById('errorMessage').classList.remove('show');
    });
    
    // Submit do formul√°rio
    analysisForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      if (!selectedFile) {
        document.getElementById('errorText').textContent = '‚ùå Por favor, selecione um arquivo.';
        document.getElementById('errorMessage').classList.add('show');
        return;
      }
      
      document.getElementById('errorMessage').classList.remove('show');
      document.getElementById('resultsCard').classList.remove('show');
      document.getElementById('loadingState').classList.add('show');
      
      analyzeBtn.disabled = true;
      analyzeBtn.textContent = '‚è≥ Analisando...';
      
      var reader = new FileReader();
      reader.onload = function(e) {
        var base64Data = e.target.result.split(',')[1];
        
        var analysisData = {
          condominio: document.getElementById('condominio').value,
          tipoContrato: document.getElementById('tipoContrato').value,
          nomeContrato: document.getElementById('nomeContrato').value,
          observacoes: document.getElementById('observacoes').value,
          aspectosAnalise: {
            pontosAtencao: document.getElementById('checkPontosAtencao').checked,
            valores: document.getElementById('checkValores').checked,
            rescisao: document.getElementById('checkRescisao').checked,
            prazos: document.getElementById('checkPrazos').checked,
            obrigacoes: document.getElementById('checkObrigacoes').checked
          },
          arquivo: {
            nome: selectedFile.name,
            tipo: selectedFile.type,
            tamanho: selectedFile.size,
            conteudo: base64Data
          },
          timestamp: new Date().toISOString()
        };
        
        fetch(WEBHOOK_URL, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(analysisData)
        })
        .then(function(r) { 
          if (r.ok) return r.json(); 
          throw new Error('Erro na an√°lise'); 
        })
        .then(function(data) {
          document.getElementById('loadingState').classList.remove('show');
          displayResults(data);
        })
        .catch(function(error) {
          console.error('Erro:', error);
          document.getElementById('loadingState').classList.remove('show');
          document.getElementById('errorText').textContent = '‚ùå Erro ao analisar contrato. Tente novamente.';
          document.getElementById('errorMessage').classList.add('show');
        })
        .finally(function() {
          analyzeBtn.disabled = false;
          analyzeBtn.textContent = 'üîç Analisar Contrato';
        });
      };
      
      reader.readAsDataURL(selectedFile);
    });
    
    function displayResults(data) {
      var html = '';
      
      if (data.contratoId || data.fornecedor || data.dataInicioContrato || data.dataEncerramentoContrato) {
        html += '<div class="contract-header"><div class="contract-info">';
        
        if (data.contratoId) {
          html += '<div class="info-item"><div class="info-label">ID do Contrato</div><div class="info-value">' + data.contratoId + '</div></div>';
        }
        if (data.fornecedor) {
          html += '<div class="info-item"><div class="info-label">Fornecedor</div><div class="info-value">' + data.fornecedor + '</div></div>';
        }
        if (data.dataInicioContrato) {
          html += '<div class="info-item"><div class="info-label">Data de In√≠cio</div><div class="info-value">' + formatDate(data.dataInicioContrato) + '</div></div>';
        }
        if (data.dataEncerramentoContrato) {
          html += '<div class="info-item"><div class="info-label">Data de Encerramento</div><div class="info-value">' + formatDate(data.dataEncerramentoContrato) + '</div></div>';
        }
        
        html += '</div></div>';
      }
      
      if (data.htmlResumo) {
        html += '<div class="analysis-section"><div class="analysis-title">üìã An√°lise Completa</div><div class="analysis-content">' + data.htmlResumo + '</div></div>';
      } else {
        if (data.resumo) {
          html += '<div class="analysis-section"><div class="analysis-title">üìã Resumo Anal√≠tico</div><div class="analysis-content">' + formatText(data.resumo) + '</div></div>';
        }
        if (data.pontosAtencao || data.pontosAtencaoTexto) {
          html += '<div class="analysis-section"><div class="analysis-title">‚ö†Ô∏è Pontos de Aten√ß√£o</div><div class="analysis-content">' + formatText(data.pontosAtencao || data.pontosAtencaoTexto) + '</div></div>';
        }
        if (data.clausulasImportantes) {
          html += '<div class="analysis-section"><div class="analysis-title">üîç Cl√°usulas Importantes</div><div class="analysis-content">' + formatText(data.clausulasImportantes) + '</div></div>';
        }
        if (data.valores) {
          html += '<div class="analysis-section"><div class="analysis-title">üí∞ Valores e Custos</div><div class="analysis-content">' + formatText(data.valores) + '</div></div>';
        }
        if (data.rescisao) {
          html += '<div class="analysis-section"><div class="analysis-title">‚õî Condi√ß√µes de Rescis√£o</div><div class="analysis-content">' + formatText(data.rescisao) + '</div></div>';
        }
        if (data.prazos) {
          html += '<div class="analysis-section"><div class="analysis-title">üìÖ Prazos e Vig√™ncias</div><div class="analysis-content">' + formatText(data.prazos) + '</div></div>';
        }
      }
      
      if (data.recomendacoes || data.recomendacoesTexto) {
        html += '<div class="analysis-section"><div class="analysis-title">‚úÖ Recomenda√ß√µes</div><div class="analysis-content">' + formatText(data.recomendacoes || data.recomendacoesTexto) + '</div></div>';
      }
      
      if (data.urlArquivoOriginal) {
        html += '<div class="analysis-section"><div class="analysis-title">üîé Arquivo Original</div><a href="' + data.urlArquivoOriginal + '" target="_blank" class="download-link">üì• Baixar Contrato Original</a></div>';
      }
      
      document.getElementById('analysisResults').innerHTML = html;
      document.getElementById('resultsCard').classList.add('show');
      document.getElementById('resultsCard').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
    
    function formatDate(dateString) {
      if (!dateString) return '';
      var date = new Date(dateString);
      return date.toLocaleDateString('pt-BR');
    }
    
    function formatText(text) {
      if (!text) return '';
      return text
        .replace(/\n/g, '<br>')
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/### (.*?)(\n|<br>|$)/g, '<h3>$1</h3>')
        .replace(/- (.*?)(\n|<br>|$)/g, '<li>$1</li>')
        .replace(/(<li>.*?<\/li>)+/g, '<ul>$&</ul>');
    }
  </script>
</body>
</html>
