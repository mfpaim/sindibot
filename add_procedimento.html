<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sindi - Orienta√ß√µes e Procedimentos</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, sans-serif; background: #f8f9fa; min-height: 100vh; padding: 20px; }
    .container { max-width: 1000px; margin: 0 auto; }
    .header { background: white; border-radius: 28px; padding: 32px 28px; margin-bottom: 24px; box-shadow: 0 15px 45px rgba(0,0,0,0.08); text-align: center; border: 1px solid #eee; }
    .logo { width: 80px; height: 80px; border-radius: 50%; border: 4px solid #FF6B35; margin: 0 auto 16px; box-shadow: 0 4px 12px rgba(255,107,53,0.25); }
    h1 { font-size: 28px; color: #222; margin-bottom: 8px; font-weight: 700; }
    .subtitle { color: #666; font-size: 16px; }
    .form-card { background: white; border-radius: 24px; padding: 32px 28px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); border: 1px solid #eee; }
    .info-banner { background: #e3f2fd; border-left: 4px solid #2196f3; padding: 16px; border-radius: 8px; margin-bottom: 24px; font-size: 14px; color: #1565c0; }
    .info-banner strong { display: block; margin-bottom: 4px; }
    .section-title { font-size: 18px; font-weight: 600; color: #333; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 2px solid #f0f0f0; }
    .form-group { margin-bottom: 20px; }
    .form-label { display: block; font-size: 14px; font-weight: 600; color: #333; margin-bottom: 8px; }
    .required { color: #FF6B35; }
    input[type="text"], select, textarea { width: 100%; padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 12px; font-size: 15px; background: white; color: #333; transition: all 0.3s; font-family: inherit; }
    textarea { resize: vertical; min-height: 150px; }
    input:focus, select:focus, textarea:focus { outline: none; border-color: #FF6B35; box-shadow: 0 0 0 3px rgba(255,107,53,0.15); }
    .form-hint { font-size: 13px; color: #999; margin-top: 6px; }
    .form-grid { display: grid; grid-template-columns: 1fr; gap: 20px; }
    @media (min-width: 640px) { .form-grid { grid-template-columns: repeat(2, 1fr); } }
    .passos-container { margin-top: 12px; }
    .passo-item { background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 12px; padding: 16px; margin-bottom: 16px; position: relative; animation: slideIn 0.3s ease; }
    @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
    .passo-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; gap: 12px; }
    .passo-number { background: #FF6B35; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; flex-shrink: 0; }
    .passo-title { flex: 1; font-weight: 600; color: #333; }
    .btn-remove-passo { background: #ffebee; color: #c62828; border: 2px solid #ef5350; padding: 6px 12px; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
    .btn-remove-passo:hover { background: #ef5350; color: white; }
    .passo-input { width: 100%; margin-bottom: 12px; }
    .media-upload-area { border: 2px dashed #e0e0e0; border-radius: 10px; padding: 16px; text-align: center; cursor: pointer; transition: all 0.3s; background: white; margin-top: 8px; }
    .media-upload-area:hover { border-color: #FF6B35; background: #fff8f5; }
    .media-upload-text { font-size: 13px; color: #666; font-weight: 600; }
    .media-preview { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }
    .media-item { position: relative; width: 100px; height: 100px; border-radius: 8px; overflow: hidden; border: 2px solid #e0e0e0; }
    .media-item img { width: 100%; height: 100%; object-fit: cover; }
    .media-item video { width: 100%; height: 100%; object-fit: cover; }
    .media-item-remove { position: absolute; top: 4px; right: 4px; background: #f44336; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: center; }
    .media-type-badge { position: absolute; bottom: 4px; left: 4px; background: rgba(0,0,0,0.7); color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 600; }
    .btn-add-passo { width: 100%; background: #e8f5e9; color: #2e7d32; border: 2px dashed #4caf50; padding: 12px; border-radius: 12px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s; margin-top: 12px; }
    .btn-add-passo:hover { background: #4caf50; color: white; border-style: solid; }
    .tag-container { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }
    .tag-item { background: #e3f2fd; color: #1976d2; padding: 6px 12px; border-radius: 16px; font-size: 13px; font-weight: 600; display: flex; align-items: center; gap: 6px; }
    .tag-item button { background: none; border: none; color: #1976d2; cursor: pointer; font-size: 16px; padding: 0; }
    .tag-input-container { display: flex; gap: 8px; margin-top: 8px; }
    .tag-input { flex: 1; }
    .btn-add-tag { background: #e3f2fd; color: #1976d2; border: 2px solid #2196f3; padding: 8px 16px; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
    .btn-add-tag:hover { background: #2196f3; color: white; }
    .btn-group { display: flex; gap: 12px; margin-top: 32px; flex-wrap: wrap; }
    .btn { flex: 1; min-width: 200px; padding: 16px; border-radius: 16px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; border: none; }
    .btn-submit { background: linear-gradient(135deg, #FF6B35 0%, #ff8555 100%); color: white; box-shadow: 0 4px 12px rgba(255,107,53,0.3); }
    .btn-submit:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(255,107,53,0.4); }
    .btn-clear { background: #f5f5f5; color: #666; border: 2px solid #e0e0e0; }
    .btn-clear:hover:not(:disabled) { background: #e8e8e8; border-color: #FF6B35; color: #FF6B35; }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
    .success-message, .error-message { padding: 16px; border-radius: 14px; margin-bottom: 24px; text-align: center; font-weight: 600; display: none; }
    .success-message { background: #e8f5e9; border: 2px solid #4caf50; color: #2e7d32; }
    .error-message { background: #ffebee; border: 2px solid #f44336; color: #c62828; }
    .success-message.show, .error-message.show { display: block; animation: slideUp 0.3s ease; }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .footer { text-align: center; margin-top: 32px; padding: 20px; color: #888; font-size: 14px; }
    .footer span { color: #FF6B35; font-weight: bold; }
    .select-wrapper { position: relative; }
    select { appearance: none; background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%23FF6B35' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 16px center; padding-right: 45px; }
    .urgencia-select { display: flex; gap: 12px; margin-top: 12px; }
    .urgencia-option { flex: 1; padding: 12px; border: 2px solid #e0e0e0; border-radius: 12px; text-align: center; cursor: pointer; transition: all 0.3s; }
    .urgencia-option input[type="radio"] { display: none; }
    .urgencia-option.baixa { color: #2e7d32; }
    .urgencia-option.media { color: #f57c00; }
    .urgencia-option.alta { color: #c62828; }
    .urgencia-option input:checked + label { font-weight: 700; }
    .urgencia-option.baixa:has(input:checked) { border-color: #4caf50; background: #e8f5e9; }
    .urgencia-option.media:has(input:checked) { border-color: #ff9800; background: #fff3e0; }
    .urgencia-option.alta:has(input:checked) { border-color: #f44336; background: #ffebee; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img class="logo" src="https://salvatore.s3.us-east-2.amazonaws.com/sindi/SindiCIrcle.png" alt="Sindi">
      <h1>Orienta√ß√µes e Procedimentos</h1>
      <p class="subtitle">Documente procedimentos com fotos e v√≠deos</p>
    </div>
    
    <div id="successMessage" class="success-message"><span id="successText">Procedimento cadastrado com sucesso!</span></div>
    <div id="errorMessage" class="error-message"><span id="errorText">Erro ao cadastrar procedimento.</span></div>
    
    <div class="form-card">
      <div class="info-banner">
        <strong>üìö Biblioteca de Procedimentos</strong>
        Crie guias completos com orienta√ß√µes passo a passo, incluindo fotos e v√≠deos para facilitar a compreens√£o.
      </div>
      
      <form id="procedimentoForm">
        <div class="section-title">üè¢ Informa√ß√µes B√°sicas</div>
        
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Condom√≠nio <span class="required">*</span></label>
            <div class="select-wrapper">
              <select id="condominio" required>
                <option value="">Selecione o condom√≠nio</option>
                <option value="Edificio Central Park">Edif√≠cio Central Park</option>
                <option value="Residencial Jardins">Residencial Jardins</option>
                <option value="Condominio Vista Verde">Condom√≠nio Vista Verde</option>
                <option value="Torres do Sol">Torres do Sol</option>
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Categoria <span class="required">*</span></label>
            <div class="select-wrapper">
              <select id="categoria" required>
                <option value="">Selecione a categoria</option>
                <option value="eletrica">‚ö° El√©trica</option>
                <option value="hidraulica">üíß Hidr√°ulica</option>
                <option value="elevador">üõó Elevador</option>
                <option value="seguranca">üîê Seguran√ßa</option>
                <option value="gas">üî• G√°s</option>
                <option value="acesso">üîë Acessos e Chaves</option>
                <option value="emergencia">üö® Emerg√™ncia</option>
                <option value="manutencao">üîß Manuten√ß√£o</option>
                <option value="outros">üìå Outros</option>
              </select>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">T√≠tulo do Procedimento <span class="required">*</span></label>
          <input type="text" id="titulo" placeholder="Ex: Como desligar o exaustor da garagem" required>
        </div>
        
        <div class="form-group">
          <label class="form-label">Descri√ß√£o Resumida</label>
          <textarea id="descricao" placeholder="Breve descri√ß√£o do procedimento..." style="min-height: 80px;"></textarea>
        </div>
        
        <div class="section-title">üìù Passo a Passo</div>
        
        <div id="passosContainer" class="passos-container"></div>
        
        <button type="button" class="btn-add-passo" onclick="addPasso()">‚ûï Adicionar Passo</button>
        
        <div class="section-title">‚ÑπÔ∏è Informa√ß√µes Complementares</div>
        
        <div class="form-group">
          <label class="form-label">Localiza√ß√£o Principal</label>
          <input type="text" id="localizacao" placeholder="Ex: 5¬∫ andar, quadro el√©trico">
        </div>
        
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Respons√°vel</label>
            <input type="text" id="responsavel" placeholder="Zelador, s√≠ndico...">
          </div>
          
          <div class="form-group">
            <label class="form-label">Telefone de Emerg√™ncia</label>
            <input type="text" id="telefone" placeholder="(00) 00000-0000">
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">N√≠vel de Urg√™ncia</label>
          <div class="urgencia-select">
            <div class="urgencia-option baixa">
              <input type="radio" name="urgencia" id="urgenciaBaixa" value="baixa" checked>
              <label for="urgenciaBaixa">üü¢ Baixa<br><small>Rotina</small></label>
            </div>
            <div class="urgencia-option media">
              <input type="radio" name="urgencia" id="urgenciaMedia" value="media">
              <label for="urgenciaMedia">üü° M√©dia<br><small>Importante</small></label>
            </div>
            <div class="urgencia-option alta">
              <input type="radio" name="urgencia" id="urgenciaAlta" value="alta">
              <label for="urgenciaAlta">üî¥ Alta<br><small>Emerg√™ncia</small></label>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Palavras-chave (Tags)</label>
          <div class="tag-input-container">
            <input type="text" id="tagInput" class="tag-input" placeholder="Ex: disjuntor, luz...">
            <button type="button" class="btn-add-tag" onclick="addTag()">+ Tag</button>
          </div>
          <div id="tagsContainer" class="tag-container"></div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Observa√ß√µes Importantes</label>
          <textarea id="observacoes" placeholder="Avisos, cuidados especiais..."></textarea>
        </div>
        
        <div class="btn-group">
          <button type="submit" class="btn btn-submit" id="submitBtn">‚ú® Cadastrar Procedimento</button>
          <button type="button" class="btn btn-clear" id="clearBtn">üóëÔ∏è Limpar</button>
        </div>
      </form>
    </div>
    
    <div class="footer">Sindi - Orienta√ß√µes e Procedimentos <span>Sindibot - Impactar LLC</span></div>
  </div>
  
  <script>
    var WEBHOOK_URL = 'https://n8n.polenta.chat/webhook-test/criar-procedimento';
    var passoCount = 0;
    var tags = [];
    var passoMedia = {};
    
    function addPasso() {
      passoCount++;
      var id = passoCount;
      passoMedia[id] = [];
      
      var container = document.getElementById('passosContainer');
      var div = document.createElement('div');
      div.className = 'passo-item';
      div.id = 'passo-' + id;
      div.innerHTML = 
        '<div class="passo-header">' +
          '<div class="passo-number">' + id + '</div>' +
          '<div class="passo-title">Passo ' + id + '</div>' +
          '<button type="button" class="btn-remove-passo" onclick="removePasso(' + id + ')">‚úñ</button>' +
        '</div>' +
        '<textarea class="passo-input" id="passoText-' + id + '" placeholder="Descreva o passo..."></textarea>' +
        '<div class="media-upload-area" onclick="triggerMediaUpload(' + id + ')">' +
          '<div class="media-upload-text">üì∑ üìπ Clique para adicionar fotos ou v√≠deos</div>' +
        '</div>' +
        '<input type="file" id="mediaInput-' + id + '" accept="image/*,video/*" multiple style="display: none;" onchange="handleMediaUpload(' + id + ')">' +
        '<div id="mediaPreview-' + id + '" class="media-preview"></div>';
      
      container.appendChild(div);
    }
    
    function removePasso(id) {
      var el = document.getElementById('passo-' + id);
      if(el) {
        el.remove();
        delete passoMedia[id];
        renumberPassos();
      }
    }
    
    function renumberPassos() {
      var passos = document.querySelectorAll('.passo-item');
      passos.forEach(function(passo, index) {
        var number = passo.querySelector('.passo-number');
        var title = passo.querySelector('.passo-title');
        if(number) number.textContent = index + 1;
        if(title) title.textContent = 'Passo ' + (index + 1);
      });
    }
    
    function triggerMediaUpload(id) {
      document.getElementById('mediaInput-' + id).click();
    }
    
    function handleMediaUpload(id) {
      var input = document.getElementById('mediaInput-' + id);
      var files = Array.from(input.files);
      
      files.forEach(function(file) {
        var reader = new FileReader();
        reader.onload = function(e) {
          var mediaObj = {
            nome: file.name,
            tipo: file.type,
            tamanho: file.size,
            conteudo: e.target.result.split(',')[1],
            isVideo: file.type.startsWith('video/')
          };
          
          passoMedia[id].push(mediaObj);
          displayMedia(id);
        };
        reader.readAsDataURL(file);
      });
    }
    
    function displayMedia(id) {
      var preview = document.getElementById('mediaPreview-' + id);
      preview.innerHTML = passoMedia[id].map(function(media, index) {
        var mediaElement = media.isVideo 
          ? '<video src="data:' + media.tipo + ';base64,' + media.conteudo + '"></video>'
          : '<img src="data:' + media.tipo + ';base64,' + media.conteudo + '">';
        
        return '<div class="media-item">' +
          mediaElement +
          '<div class="media-type-badge">' + (media.isVideo ? 'üé•' : 'üì∑') + '</div>' +
          '<button class="media-item-remove" onclick="removeMedia(' + id + ', ' + index + ')">‚úñ</button>' +
        '</div>';
      }).join('');
    }
    
    function removeMedia(passoId, mediaIndex) {
      passoMedia[passoId].splice(mediaIndex, 1);
      displayMedia(passoId);
    }
    
    function addTag() {
      var input = document.getElementById('tagInput');
      var tag = input.value.trim();
      if(tag && !tags.includes(tag)) {
        tags.push(tag);
        displayTags();
        input.value = '';
      }
    }
    
    function removeTag(tag) {
      tags = tags.filter(function(t) { return t !== tag; });
      displayTags();
    }
    
    function displayTags() {
      var container = document.getElementById('tagsContainer');
      container.innerHTML = tags.map(function(tag) {
        return '<div class="tag-item">' + tag + '<button onclick="removeTag(\'' + tag + '\')">‚úñ</button></div>';
      }).join('');
    }
    
    document.getElementById('tagInput').addEventListener('keypress', function(e) {
      if(e.key === 'Enter') {
        e.preventDefault();
        addTag();
      }
    });
    
    addPasso();
    addPasso();
    addPasso();
    
    document.getElementById('clearBtn').addEventListener('click', function() {
      document.getElementById('procedimentoForm').reset();
      document.getElementById('passosContainer').innerHTML = '';
      passoCount = 0;
      passoMedia = {};
      tags = [];
      displayTags();
      addPasso();
      addPasso();
      addPasso();
      document.getElementById('successMessage').classList.remove('show');
      document.getElementById('errorMessage').classList.remove('show');
    });
    
    document.getElementById('procedimentoForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      var passos = [];
      var passoElements = document.querySelectorAll('.passo-item');
      passoElements.forEach(function(el, index) {
        var passoId = el.id.split('-')[1];
        var input = document.getElementById('passoText-' + passoId);
        if(input && input.value.trim()) {
          passos.push({
            numero: index + 1,
            descricao: input.value.trim(),
            midias: passoMedia[passoId] || []
          });
        }
      });
      
      if(passos.length === 0) {
        document.getElementById('errorText').textContent = '‚ùå Adicione pelo menos um passo.';
        document.getElementById('errorMessage').classList.add('show');
        return;
      }
      
      document.getElementById('successMessage').classList.remove('show');
      document.getElementById('errorMessage').classList.remove('show');
      
      var submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.textContent = '‚è≥ Enviando...';
      
      var urgenciaChecked = document.querySelector('input[name="urgencia"]:checked');
      
      var formData = {
        condominio: document.getElementById('condominio').value,
        categoria: document.getElementById('categoria').value,
        titulo: document.getElementById('titulo').value,
        descricao: document.getElementById('descricao').value,
        passos: passos,
        localizacao: document.getElementById('localizacao').value,
        responsavel: document.getElementById('responsavel').value,
        telefone: document.getElementById('telefone').value,
        urgencia: urgenciaChecked ? urgenciaChecked.value : 'baixa',
        tags: tags,
        observacoes: document.getElementById('observacoes').value,
        timestamp: new Date().toISOString()
      };
      
      fetch(WEBHOOK_URL, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(formData)
      })
      .then(function(r) { if(r.ok) return r.json(); throw new Error('Erro'); })
      .then(function() {
        document.getElementById('successText').textContent = '‚úÖ Procedimento cadastrado com sucesso!';
        document.getElementById('successMessage').classList.add('show');
        document.getElementById('procedimentoForm').reset();
        document.getElementById('passosContainer').innerHTML = '';
        passoCount = 0;
        passoMedia = {};
        tags = [];
        displayTags();
        addPasso();
        addPasso();
        addPasso();
        setTimeout(function() { document.getElementById('successMessage').classList.remove('show'); }, 5000);
      })
      .catch(function(error) {
        console.error('Erro:', error);
        document.getElementById('errorText').textContent = '‚ùå Erro ao cadastrar. Tente novamente.';
        document.getElementById('errorMessage').classList.add('show');
      })
      .finally(function() {
        submitBtn.disabled = false;
        submitBtn.textContent = '‚ú® Cadastrar Procedimento';
      });
    });
  </script>
</body>
</html>
